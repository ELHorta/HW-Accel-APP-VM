# **ZCU104 Hardware Acceleration Application** 

Before running the application using hardware acceleration, the configuration file containing the hardware kernel and the drivers to communicate with the FPGA must be generated using the Vitis tools. The files needed are the description of the hardware kernel in a high level language, such as C, and the the FPGA infrastructure definition.


### HW Kernel (Vitis) 
The hardware kernel must be generated in a machine where the Vitis tools are installed.

The first step is to create a folder and copy the required files to this folder:
```
mkdir xclbin_vadd
cd xclbin_vadd  ``\
sudo wget --no-check-certificate 'https://docs.google.com/uc?export=download&id=1rOQhjtGtkARlSGK3MssCCIHKSXa_Vgqf' -O zcu104_custom_platform_hw.xsa
sudo wget --no-check-certificate 'https://docs.google.com/uc?export=download&id=1Xi5XFbTC74Mn_RW8HoCRiHgtQRxto111' -O krnl_vadd.cpp
```

The XCLBIN file is generated by executing these commands:
```
source /tools/Xilinx/Vitis/2022.1/settings64.sh

v++ -t hw --platform zcu104_custom_platform_hw.xsa -c -k krnl_vadd -o krnl_vadd.xo 'krnl_vadd.cpp'

v++ -t hw --platform zcu104_custom_platform_hw.xsa -l -o krnl_vadd.xclbin krnl_vadd.xo
```

The XCLBIN file generation takes approximately 30 minutes. A ready to be used XCLBIN file is available (see next step).



### Host Application (ZCU104)  

The host application will call the OpenCL APIs that are responsible for the FPGA reconfiguration with the XCLBIN file generated in the previous step.

The following commands create a folder to download the XCLBIN file and the source code for the host application:

```
cd
mkdir vadd_host_app
cd vadd_host_app
sudo wget --no-check-certificate 'https://docs.google.com/uc?export=download&id=19Gd-bvrM5AgwJn5cX0Q8eUBHDOQA5a3U' -O krnl_vadd.xclbin
sudo wget --no-check-certificate 'https://docs.google.com/uc?export=download&id=1hH3H_C2A91ZTJXSPpyfrWSbSfANAyjpe' -O vadd_host.cpp
sudo wget --no-check-certificate 'https://docs.google.com/uc?export=download&id=1jt8Er6U0tIglQ45KzOLsPig9-XrzW88m' -O vadd_host_load_krnl.cpp
sudo wget --no-check-certificate 'https://docs.google.com/uc?export=download&id=1u93StdjjfL3B3CXqHfajXH8b9R8oHXZo' -O vadd.h
sudo wget --no-check-certificate 'https://docs.google.com/uc?export=download&id=1QzNkHeiu_BDubPsjlOj1YR-tCI8xYeZB' -O xrt.ini
```


To compile the host application, use this command
```
g++ -O0 -Wall -g  -I ./ vadd_host* -lOpenCL -lpthread -lm -o host_vadd
```

Now you can run the host application:
```
./host_vadd
```

If everything is correct, you will get the following messages: 
```
ubuntu@zynqmp:~/vadd_host_app$ ./host_vadd
INFO: Reading krnl_vadd.xclbin
Loading: 'krnl_vadd.xclbin'
Trying to program device[0]: edge
Device[0]: program successful!
TEST PASSED
```

Now it is possible to run the application using hardware acceleration, [Inside a Virtual Machine](/zcu104_vm_hw_accel)









